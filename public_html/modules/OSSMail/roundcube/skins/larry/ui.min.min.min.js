
function rcube_mail_ui(){function x(a){F||(F=rcmail.local_storage_get_item("prefs.larry",{}));if(null==F[a]){var c=rcmail.get_cookie(a);null!=c&&(F[a]=c,rcmail.local_storage_set_item("prefs.larry",F)&&rcmail.set_cookie(a,c,new Date))}return F[a]}function H(a,d){F[a]=d;if(!rcmail.local_storage_set_item("prefs.larry",F)){var c=new Date;c.setYear(c.getFullYear()+1);rcmail.set_cookie(a,d,c)}}function K(a){a=a?10:0;rcmail.resize_timeout&&window.clearTimeout(rcmail.resize_timeout);rcmail.resize_timeout=window.setTimeout(function(){"mail"==rcmail.env.task&&("show"==rcmail.env.action||"preview"==rcmail.env.action?b():"compose"==rcmail.env.action&&N());$("body.iframe .footerleft").each(function(){var g=$(this),c=$(document.body),i=g.hasClass("floating"),d=c.outerHeight(!0)>$(window).height();d!=i&&(i=d?"addClass":"removeClass",g[i]("floating"),c[i]("floatingbuttons"))})},a)}function y(a){var d=$(a.object).siblings("div");d.length&&$(a.object).insertBefore(d.first());if("error"==a.type&&"login"!=rcmail.env.task){rcmail.hide_message(a.object);z.message_timer&&window.clearTimeout(z.message_timer);z.messagedialog||(z.messagedialog=$("<div>").addClass("popupdialog").hide());var d=a.message,c=function(){z.messagedialog.is(":visible")&&z.messagedialog.dialog("destroy").hide()};z.messagedialog.is(":visible")&&z.messagedialog.text()!=d&&(d=z.messagedialog.html()+"<p>"+a.message+"</p>");z.messagedialog.html(d).dialog({resizable:!1,closeOnEscape:!0,dialogClass:"popupmessage "+a.type,title:rcmail.gettext("errortitle"),close:c,position:["center","center"],hide:{effect:"fadeOut"},width:420,minHeight:90}).show();z.messagedialog.closest("div[role=dialog]").attr("role","alertdialog");0<a.timeout&&(z.message_timer=window.setTimeout(c,a.timeout))}}function b(){$("#messagecontent").css("top",$("#messageheader").outerHeight()+1+"px");$("#message-objects div a").addClass("button");$("#attachment-list li").length||($("div.rightcol").hide().attr("aria-hidden","true"),$("div.leftcol").css("margin-right","0"));var a=$("#messagebody.mailvelope, #messagebody > .mailvelope");if(a.length){var c=$("#messagecontent").length?$("#messagecontent").height()-16:$(window).height()-a.offset().top-10;a.height(c)}}function u(a){}function w(a){}function e(a){if("TEXTAREA"==a.nodeName){var d=$(a),c=a.scrollHeight;d.css("height",14*(80<a.value.length&&21<c?2:1)+"px");N()}}function N(){var d=$("#composebody"),a=$("#compose-content"),i=$("#composeview-bottom"),g,c;g=a.height()-i.position().top;c=300-g;i.height(Math.max(300,g));a.css("overflow",0<c?"auto":"hidden");a=d.parent().width()-5;i=d.parent().height()-8;d.width(a).height(i);$("#composebodycontainer > div").width(a+8);$("#composebody_ifr").height(i+4-$("div.mce-toolbar").height());$("#googie_edit_layer").width(a).height(i);d=$("#directorylist");d.length&&$("#compose-contacts .scroller").css("top",d.position().top+d.outerHeight())}function D(d){var c=$("#quotadisplay"),a=$("#quotamenu"),g=d.total?24*Math.ceil(d.percent/100*20):0;d.total&&480==g&&100>d.percent&&(g-=24);c.css("background-position","0 -"+g+"px");c.attr("class","countdisplay p"+10*Math.round(d.percent/10));d.table&&(a.length||(a=$('<div id="quotamenu" class="popupmenu">').appendTo($("body"))),a.html(d.table),c.css("cursor","pointer").off("click").on("click",function(i){return rcmail.command("menu-open","quotamenu",i.target,i)}))}function f(a){$(".boxtitle a.search",a).click(function(c){var j=$(".boxtitle",a),g=$(".listsearchbox",a),d=g.is(":visible")?-1:1,i=34+($("select",g).length?22:0);g.slideToggle({duration:160,progress:function(m,o){0>d&&(o=1-o);$(".scroller",a).css("top",j.outerHeight()+i*o+"px")},complete:function(){g.toggleClass("expanded");g.is(":visible")?(g.find("input[type=text]").focus(),i=34+($("select",g).length?$("select",g).outerHeight()+4:0),$(".scroller",a).css("top",j.outerHeight()+i+"px")):$("a.reset",g).click()}});return !1})}function A(a){"reply-list"==a.command&&1==rcmail.env.reply_all_mode?(a=rcmail.gettext(a.status?"replylist":"replyall"),"preview"==rcmail.env.action?$("a.button.replyall").attr("title",a):$("a.button.reply-all").text(a).attr("title",a)):"compose-encrypted"==a.command&&$("a.button.encrypt").show()}function I(c,a){var d=n[c]=$("#"+c);d.appendTo(document.body);d.length&&(Q[c]=$.extend(Q[c]||{},a||{}))}function l(){$("#preview-shortheaders").toggle();var a=$("#preview-allheaders").toggle(),c=$("a#previewheaderstoggle");a.is(":visible")?c.attr("href","#hide").removeClass("add").addClass("remove").attr("aria-expanded","true"):c.attr("href","#details").removeClass("remove").addClass("add").attr("aria-expanded","false");H("previewheaders",a.is(":visible")?"1":"0")}function p(a,c){if(c||!$("#mail"+a+"mode").hasClass("disabled")){$("#maillistmode, #mailthreadmode").removeClass("selected").attr("tabindex","0").attr("aria-disabled","false"),$("#mail"+a+"mode").addClass("selected").attr("tabindex","-1").attr("aria-disabled","true")}}function r(c){if(c&&"messagelistmenu"==c.name){C(c)}else{if(c){var g=Q[c.name]||{},d=$(g.link||"#"+c.name+"link"),i=c.obj&&c.obj.is(":visible");if(c.obj&&i&&d.length){var a=d.parent();$(window);a.hasClass("dropbutton")&&(d=a);if(g.above||d.hasClass("dropbutton")){a=d.offset(),c.obj.css({left:a.left+"px",top:a.top+(g.above?-c.obj.height():d.outerHeight())+"px"})}}c.obj&&g.iconized&&c.obj.children("ul").addClass("iconized");c.obj&&g.editable&&c.obj.attr("data-editable","true");"function"==typeof g.callback&&g.callback(i,c)}}}function G(c,d){var a=c.parentNode.id.replace(/^attach/,"");$("#attachmenuopen").off("click").attr("onclick","").click(function(g){return rcmail.command("open-attachment",a,this)});$("#attachmenudownload").off("click").attr("onclick","").click(function(){rcmail.command("download-attachment",a,this)});Q.attachmentmenu.link=c;rcmail.command("menu-open",{menu:"attachmentmenu",id:a},c,d)}function C(a){var c=$("#listoptions");c.is(":visible")?c.dialog("close",a.originalEvent):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.listcols))}),c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,open:function(d){setTimeout(function(){c.find("a, input:not(:disabled)").not("[aria-disabled=true]").first().focus()},100)},close:function(d){c.dialog("destroy").hide();d.originalEvent&&rcube_event.is_keyboard(d.originalEvent)&&$("#listmenulink").focus()},minWidth:500,width:c.width()+25}).show())}function J(c){$("#listoptions").dialog("close");rcube_event.is_keyboard(c.originalEvent)&&$("#listmenulink").focus();c=$('input[name="sort_col"]:checked').val();var d=$('input[name="sort_ord"]:checked').val(),a=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(a,c,d,rcmail.env.threading)}function M(a){a=$("#contacts-table");var c=a.parent().css("overflow","hidden");a.clone().css({position:"absolute",top:"0",left:"0",width:a.width()+"px","z-index":10}).appendTo(c).animate({left:-(a.width()+5)+"px"},300,"swing",function(){$(this).remove();c.css("overflow","auto")})}function P(c){c=$("#contacts-table");var d=c.parent().css("overflow","hidden"),a=c.clone().appendTo(d);c.css({position:"absolute",top:"0",left:-(c.width()+5)+"px",width:c.width()+"px",height:c.height()+"px","z-index":10}).animate({left:"0"},300,"linear",function(){a.remove();$(this).css({position:"relative",left:"0",width:"100%",height:"auto","z-index":1});d.css("overflow","auto")})}function t(a){var c=$("#upload-dialog");c.is(":visible")?c.dialog("close"):rcmail.mailvelope_editor||("compose"!=rcmail.env.action||c.data("extended")||($("<a>").addClass("iconlink add").attr("href","#add").html("Add").appendTo($('input[type="file"]',c).parent()).click(q),c.data("extended",!0)),c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:c.attr("title"),open:function(d){document.all||$("input[type=file]",c).first().click()},close:function(){try{$("#upload-dialog form").get(0).reset()}catch(d){}c.dialog("destroy").hide();$("div.addline",c).remove()},width:480}).show())}function q(a){a=$(this).parent();a=a.clone().addClass("addline").insertAfter(a);a.children(".iconlink").click(q);a.children("input").val("");document.all||$("input[type=file]",a).click()}function L(c,d){var a=$("#compose-"+c);if(!a.is(":visible")){return O[c]&&!d&&$("#_"+c).val(O[c]),a.show(),$("#"+c+"-link").hide(),N(),$("input,textarea",a).focus(),!1}}function s(a,c){var g=$(a),i=g.get(0).id,j=g.children("fieldset");if(j.length){i||(i="rcmtabcontainer",g.attr("id",i));var d=$("<ul>").addClass("tabsbar").prependTo(g);j.each(function(R){var S,m=$(this),o=m.children("legend"),E=i+"-t"+R;S=$("<a>").text(o.text()).attr("href","#"+E);R=$("<li>").addClass("tablink");o.remove();m.attr("id",E);R.append(S).appendTo(d)});g.tabs({active:c||0,heightStyle:"content",activate:function(m,o){K()}})}}var k={},n={},Q={forwardmenu:{editable:1},searchmenu:{editable:1,callback:function(a){if(a&&rcmail.env.search_mods){var c,g;a=$('input:checkbox[name="s_mods[]"]',n.searchmenu);var i=rcmail.env.mailbox,j=rcmail.env.search_mods,d=rcmail.env.search_scope||"base";"mail"==rcmail.env.task?("all"==d&&(i="*"),j=j[i]?j[i]:j["*"],g="text",$('input:radio[name="s_scope"]').prop("checked",!1).filter("#s_scope_"+d).prop("checked",!0)):g="*";if(j[g]){a.map(function(){this.checked=!0;this.disabled=this.value!=g})}else{for(c in a.prop("disabled",!1).prop("checked",!1),j){$("#s_mod_"+c).prop("checked",!0)}}}}},attachmentmenu:{},listoptions:{editable:1},groupmenu:{above:1},mailboxmenu:{above:1},spellmenu:{callback:function(m,a){var d,g,j,c=rcmail.spellcheck_lang(),i=$("ul",a.obj);if(!i.length){i=$('<ul class="toolbarmenu selectable" role="menu">');for(d in rcmail.env.spell_langs){j=$('<li role="menuitem">'),g=$('<a href="#'+d+'" tabindex="0"></a>').text(rcmail.env.spell_langs[d]).addClass("active").data("lang",d).on("click keypress",function(o){if("keypress"!=o.type||13==rcube_event.get_keycode(o)){return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spellmenu",o),!1}}),g.appendTo(j),j.appendTo(i)}i.appendTo(a.obj)}$("li",i).each(function(){var o=$("a",this);o.data("lang")==c?o.addClass("selected").attr("aria-selected","true"):o.hasClass("selected")&&o.removeClass("selected").removeAttr("aria-selected")})}},"folder-selector":{iconized:1}},z=this,B,O={},F;this.set=function(a,c){k[a]=c};this.init=function(){rcmail.addEventListener("message",y);$("#taskbar a").each(function(j,m){$(m).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")});$("#taskbar .minmodetoggle").click(function(j){j=$(document.body).toggleClass("minimal").hasClass("minimal");H("minimalmode",j?1:0);$(window).resize()});if("mail"==rcmail.env.task){rcmail.addEventListener("menu-open",r).addEventListener("menu-close",r).addEventListener("menu-save",J).addEventListener("enable-command",A).addEventListener("responseafterlist",function(j){p(rcmail.env.threading?"thread":"list",!0)}).addEventListener("responseaftersearch",function(j){p(rcmail.env.threading?"thread":"list",!0)});var a=$("#dragmessagemenu");a.length&&(rcmail.gui_object("dragmenu","dragmessagemenu"),n.dragmenu=a);if("show"==rcmail.env.action||"preview"==rcmail.env.action){rcmail.addEventListener("aftershow-headers",function(){b()}).addEventListener("afterhide-headers",function(){b()}),$("#previewheaderstoggle").click(function(j){l();this.blur&&!rcube_event.is_keyboard(j)&&this.blur();return !1}),$("#attachment-list > li").each(function(){$(this).append($('<a class="drop" tabindex="0" aria-haspopup="true">Show options</a>').on("click keypress",function(j){if("keypress"!=j.type||13==rcube_event.get_keycode(j)){return G(this,j),!1}}))}),"1"==x("previewheaders")&&l()}else{if("compose"==rcmail.env.action){rcmail.addEventListener("aftersend-attachment",t).addEventListener("aftertoggle-editor",function(j){window.setTimeout(function(){N()},200);j&&j.mode&&$("select[name='editorSelector']").val(j.mode)}).addEventListener("compose-encrypted",function(j){$("select[name='editorSelector']").prop("disabled",j.active);$("a.button.attach, a.button.responses")[j.active?"addClass":"removeClass"]("disabled");$("#responseslist a.insertresponse")[j.active?"removeClass":"addClass"]("active")});for(var d,c,g=["cc","bcc","replyto","followupto"],a=0;a<g.length;a++){d=g[a],c=$("#_"+d),c.length&&(c.on("change",{v:d},function(j){this.value&&L(j.data.v,!0)}),""!=c.val()&&L(d,!0))}$("#composeoptionstoggle").click(function(j){var m=$("#composeoptions").toggle().is(":visible");$("#composeoptionstoggle").toggleClass("remove").attr("aria-expanded",m?"true":"false");N();H("composeoptions",m?"1":"0");rcube_event.is_keyboard(j)||this.blur();return !1}).css("cursor","pointer");"0"!==x("composeoptions")&&$("#composeoptionstoggle").click();$("textarea[name='_to'], textarea[name='_cc'], textarea[name='_bcc']").change(function(j){e(this)}).change();rcmail.addEventListener("autocomplete_insert",function(j){e(j.field)});(a=rcmail.opener())&&"compose"==a.env.action&&$("#composeoptionstoggle",opener.document).hasClass("remove")&&$("#composeoptionstoggle").click();(new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:!0,start:206,min:170,size:12,render:N})).init()}else{"list"!=rcmail.env.action&&rcmail.env.action?"get"==rcmail.env.action&&(new rcube_splitter({id:"mailpartsplitterv",p1:"#messagepartheader",p2:"#messagepartcontainer",orientation:"v",relative:!0,start:226,min:150,size:12})).init():(a=$("#mailpreviewframe").is(":visible"),$("#mailpreviewtoggle").addClass(a?"enabled":"closed").attr("aria-expanded",a?"true":"false").click(function(o){o=$(o.target);var E=$("#mailpreviewframe"),j=!E.is(":visible");B.pos||parseInt(x("mailviewsplitter")||320);var m;E.toggle();o.toggleClass("enabled closed").attr("aria-expanded",j?"true":"false");j?($("#mailview-top").removeClass("fullheight").css({bottom:"auto"}),$("#mailview-bottom").css({height:"auto"}).show(),rcmail.env.contentframe="messagecontframe",(m=rcmail.message_list.get_single_selection())&&rcmail.show_message(m,!1,!0),B.handle?(B.handle.show(),B.resize()):B.init()):(rcmail.env.contentframe=null,rcmail.show_contentframe(!1),$("#mailview-top").addClass("fullheight").css({height:"auto",bottom:"0px"}),$("#mailview-bottom").css({top:"auto",height:"0px"}).hide(),B.handle&&B.handle.hide());rcmail.message_list&&(j&&m&&rcmail.message_list.scrollto(m),rcmail.message_list.resize());rcmail.command("save-pref",{name:"preview_pane",value:j?1:0});return !1}),$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(j){p("list");return !1}),$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(j){p("thread");return !1}),B=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:!0,start:276,min:150,size:12,offset:4}),a&&B.init(),rcmail.init_pagejumper("#pagejumper"),rcmail.addEventListener("setquota",D).addEventListener("afterimport-messages",t))}}$("#mailview-left").length&&(new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",relative:!0,start:206,min:150,size:12,callback:u,render:w})).init()}else{if("settings"==rcmail.env.task){if(rcmail.addEventListener("init",function(){var j="#settingstabpreferences";rcmail.env.action&&(j="#settingstab"+(0<rcmail.env.action.indexOf("identity")?"identities":rcmail.env.action.replace(/\./g,"")));$(j).addClass("selected").children().first().removeAttr("onclick").click(function(){return !1})}),"folders"==rcmail.env.action){(new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:!0,start:266,min:180,size:12})).init(),rcmail.addEventListener("setquota",D),f($("#folderslist"))}else{if("identities"==rcmail.env.action){(new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12})).init()}else{if("responses"==rcmail.env.action){(new rcube_splitter({id:"responseviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12})).init()}else{if("preferences"==rcmail.env.action||!rcmail.env.action){(new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:!0,start:266,min:180,size:12})).init()}else{if("edit-prefs"==rcmail.env.action){var a=$("#preferences-details fieldset.advanced legend"),i=$('<a href="#toggle"></a>').text(rcmail.gettext("toggleadvancedoptions")).attr("title",rcmail.gettext("toggleadvancedoptions")).addClass("advanced-toggle");a.click(function(j){i.html($(this).hasClass("collapsed")?"&#9650;":"&#9660;");$(this).toggleClass("collapsed").closest("fieldset").children(".propform").toggle()}).append(i).addClass("collapsed");bw.mz&&a.parents("form").css("display","inline")}}}}}}else{"addressbook"==rcmail.env.task&&(rcmail.addEventListener("afterupload-photo",t).addEventListener("beforepushgroup",M).addEventListener("beforepopgroup",P).addEventListener("menu-open",r).addEventListener("menu-close",r),""==rcmail.env.action&&((new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:!0,start:206,min:150,size:12,render:w})).init(),(new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:!0,start:266,min:260,size:12})).init()),a=$("#dragcontactmenu"),a.length&&(rcmail.gui_object("dragmenu","dragcontactmenu"),n.dragmenu=a))}}$(".tabbed").each(function(j,m){s(m)});$("select.decorated").each(function(){if(bw.opera){$(this).removeClass("decorated")}else{var R=$(this),S=R.parent(),j=Math.max(R.height(),26)-2,m=R.width()-22,o=$("option",this).first().text();""!=$("option:selected",this).val()&&(o=$("option:selected",this).text());var E=$('<a class="menuselector" tabindex="-1"><span class="handle">'+o+"</span></a>").css("position","absolute").offset(R.position()).insertAfter(R);E.children().width(m).height(j).css("line-height",j-1+"px");"absolute"!=S.css("position")&&S.css("position","relative");R.width(E.width()).on(bw.mz?"change keyup":"change",function(){var T=$("option:selected",this).text();$(this).next().children().text(T)});R.on("focus",function(T){E.addClass("focus")}).on("blur",function(T){E.removeClass("focus")})}});a=$("body.minwidth");a.length&&a.css("min-width",$(".toolbar").width()+$("#quicksearchbar").width()+$("#searchfilter").width()+30);window.onresize=K;K()};this.init_tabs=s;this.show_about=function(a){var c=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about"),frameborder:"0"});h=Math.floor(0.75*$(window).height());buttons={};supportln=$("#supportlink");supportln.length&&(k.supporturl=supportln.attr("href"))&&(buttons[supportln.html()]=function(d){0>k.supporturl.indexOf("mailto:")?window.open(k.supporturl):location.href=k.supporturl});c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:a?a.title||a.innerHTML:null,close:function(){c.dialog("destroy").remove()},buttons:buttons,width:640,height:h}).width(640)};this.show_popup=function(c,d,g){!g&&Q[c]||I(c,g);g=Q[c]||{};g=$(g.link?g.link:"#"+c+"link");var a=g.offset();g.has(".inner")&&(g=g.children(".inner"));return rcmail.command("menu-open",{menu:c,show:d},g.get(0),$.Event("click",{target:g.get(0),pageX:a.left,pageY:a.top,clientX:a.left,clientY:a.top}))};this.toggle_popup=function(c,d,a){!a&&Q[c]||I(c,a);return rcmail.command("menu-open",c,d.target,d)};this.add_popup=I;this.set_searchmod=function(c){var d,g;d=rcmail.env.task;var i=rcmail.env.search_mods,a=rcmail.env.mailbox;"all"==$('input[name="s_scope"]:checked').val()&&(a="*");i||(i={});"mail"==d?(i[a]||(i[a]=rcube_clone_object(i["*"])),g=i[a],d="text"):(g=i,d="*");c.checked?g[c.value]=1:delete g[c.value];c.value==d&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=c&&(this.checked=!0,c.checked?(this.disabled=!0,delete g[this.value]):(this.disabled=!1,g[this.value]=1))});rcmail.set_searchmods(g)};this.set_searchscope=function(a){rcmail.set_searchscope(a.value)};this.show_uploadform=t;this.show_header_row=L;this.hide_header_row=function(a){var c=$("#_"+a);O[a]=c.val();c.val("");$("#compose-"+a).hide();$("#"+a+"-link").show();N();return !1};this.update_quota=D;this.get_pref=x;this.save_pref=H;this.folder_search_init=f;if(window.$&&document.body){var v=x("minimalmode");(parseInt(v)||null===v&&850>$(window).height())&&$(document.body).addClass("minimal");bw.tablet&&$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");$(document).ready(function(){z.init()})}}function rcube_scroller(g,i,e){var f=this;this.list=$(g);this.top=$(i);this.bottom=$(e);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){rcmail.drag_active&&(f.ts=window.setTimeout(function(){f.scroll("down")},f.delay))}).mouseout(function(){f.ts&&window.clearTimeout(f.ts)});this.bottom.mouseenter(function(){rcmail.drag_active&&(f.ts=window.setTimeout(function(){f.scroll("up")},f.delay))}).mouseout(function(){f.ts&&window.clearTimeout(f.ts)});this.scroll=function(b){var c=this,a=this.step_size;rcmail.drag_active&&("down"==b&&(a*=-1),this.list.get(0).scrollTop+=a,this.ts=window.setTimeout(function(){c.scroll(b)},this.step_time))}}function rcube_splitter(f){function j(a){if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="none"}b.p1pos=b.relative?b.p1.position():b.p1.offset();b.p2pos=b.relative?b.p2.position():b.p2.offset();b.drag_active=!0;$(document).on("mousemove."+this.id,k).on("mouseup."+this.id,m);$("iframe").each(function(d,c){$("<div>").attr("id","iframe-splitter-fix-"+d).addClass("iframe-splitter-fix").css({background:"#fff",width:c.offsetWidth+"px",height:c.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body")})}function k(a){if(!b.drag_active){return !1}window.clearTimeout(b.ts);b.ts=window.setTimeout(function(){var c=rcube_event.get_mouse_pos(a);if(b.relative){var d=b.parent.offset();c.x-=d.left;c.y-=d.top}b.horizontal?c.y-b.halfsize>b.p1pos.top&&c.y+b.halfsize<b.p2pos.top+b.p2.outerHeight()&&(b.pos=Math.max(b.min,c.y-Math.max(0,b.offset)),b.pos>b.min&&(b.pos=Math.min(b.pos,b.parent.height()-b.min)),b.resize()):c.x-b.halfsize>b.p1pos.left&&c.x+b.halfsize<b.p2pos.left+b.p2.outerWidth()&&(b.pos=Math.max(b.min,c.x-Math.max(0,b.offset)),b.pos>b.min&&(b.pos=Math.min(b.pos,b.parent.width()-b.min)),b.resize());b.p1pos=b.relative?b.p1.position():b.p1.offset();b.p2pos=b.relative?b.p2.position():b.p2.offset()},1);return !1}function m(a){if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="auto"}$(document).off("."+b.id);b.drag_active=!1;$("div.iframe-splitter-fix").remove();b.set_cookie();"function"==typeof b.callback&&b.callback(b);return bw.safari?!0:rcube_event.cancel(a)}function l(a){b.horizontal?(a=parseInt(b.parent.outerHeight(),10)-parseInt(b.p2[0].style.top,10)-(bw.ie8?2:0),b.p2.css("height",(0<a?a:0)+"px")):(a=parseInt(b.parent.outerWidth(),10)-parseInt(b.p2[0].style.left,10),b.p2.css("width",(0<a?a:0)+"px"))}this.p=f;this.id=f.id;this.horizontal="horizontal"==f.orientation||"h"==f.orientation;this.halfsize=(void 0!==f.size?f.size:10)/2;this.pos=f.start||0;this.min=f.min||20;this.offset=f.offset||0;this.relative=f.relative?!0:!1;this.drag_active=!1;this.render=f.render;this.callback=f.callback;var b=this;rcube_splitter._instances[this.id]=b;this.init=function(){this.p1=$(this.p.p1);this.p2=$(this.p.p2);this.parent=this.p1.parent();if(this.p1.length&&this.p2.length){this.p1pos=this.relative?this.p1.position():this.p1.offset();this.p2pos=this.relative?this.p2.position():this.p2.offset();this.handle=$("<div>").attr("id",this.id).attr("unselectable","on").attr("role","presentation").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.parent).mousedown(j);if(this.horizontal){var a=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:a+"px"})}else{a=this.p1pos.left+this.p1.outerWidth(),this.handle.css({left:a+"px",top:"0px"})}bw.ie&&$(window).resize(l);(a=this.get_cookie())&&!isNaN(a)?(this.pos=parseFloat(a),this.resize()):this.pos&&(this.resize(),this.set_cookie())}};this.resize=function(){if(this.horizontal){if(this.p1.css("height",Math.floor(this.pos-this.p1pos.top-Math.floor(this.halfsize))+"px"),this.p2.css("top",Math.ceil(this.pos+Math.ceil(this.halfsize)+2)+"px"),this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px"),bw.ie){var a=parseInt(this.parent.outerHeight(),10)-parseInt(this.p2.css("top"),10)-(bw.ie8?2:0);this.p2.css("height",(0<a?a:0)+"px")}}else{this.p1.css("width",Math.floor(this.pos-this.p1pos.left-Math.floor(this.halfsize))+"px"),this.p2.css("left",Math.ceil(this.pos+Math.ceil(this.halfsize))+"px"),this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset+3)+"px"),bw.ie&&(a=parseInt(this.parent.outerWidth(),10)-parseInt(this.p2.css("left"),10),this.p2.css("width",(0<a?a:0)+"px"))}this.p2.resize();this.p1.resize();this.drag_active&&$("iframe").each(function(e,c){var d=$(this).offset();$("#iframe-splitter-fix-"+e).css({top:d.top+"px",left:d.left+"px",width:c.offsetWidth+"px",height:c.offsetHeight+"px"})});"function"==typeof this.render&&this.render(this)};this.get_cookie=function(){return window.UI?UI.get_pref(this.id):null};this.set_cookie=function(){window.UI&&UI.save_pref(this.id,this.pos)}}rcube_splitter._instances={};rcube_splitter.get_instance=function(b){return rcube_splitter._instances[b]};