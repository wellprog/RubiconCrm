
Vtiger_List_Js("Settings_Users_List_Js",{deleteRecord:function(b){var a=app.vtranslate("LBL_DELETE_USER_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:a}).then(function(c){AppConnector.request(b).then(function(d){if(d){var e=function(f){var g=app.validationEngineOptions;g.onValidationComplete=function(i,h){if(h){Settings_Users_List_Js.deleteUser(i)}return false};jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(d,function(f){if(typeof e=="function"){e(f)}})}})},function(c,d){})},deleteUser:function(d){var c=Vtiger_List_Js.getInstance();var a=d.find('[name="userid"]').val();var b=d.find('[name="tranfer_owner_id"]').val();var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var f={module:app.getModuleName(),action:"DeleteAjax",transfer_user_id:b,userid:a,permanent:jQuery('[name="deleteUserPermanent"]:checked',d).val()};AppConnector.request(f).then(function(i){if(i.success){app.hideModalWindow();e.progressIndicator({mode:"hide"});var j=jQuery("#orderBy").val();var h=jQuery("#sortOrder").val();var g={viewname:i.result.viewname,orderby:j,sortorder:h};jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");c.getListViewRecords(g).then(function(){c.updatePagination()});f={title:app.vtranslate("JS_MESSAGE"),text:i.result.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(f)}})},deleteUserPermanently:function(a,d){d.stopPropagation();var c=app.vtranslate("LBL_DELETE_USER_PERMANENT_CONFIRMATION");var b="index.php?module="+app.getModuleName()+"&parent="+app.getParentModuleName()+"&view=DeleteUser&mode=permanent&record="+a;Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(e){AppConnector.request(b).then(function(f){if(f){var g=function(h){var i=app.validationEngineOptions;i.onValidationComplete=function(k,j){if(j){var l=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var m={module:app.getModuleName(),action:"DeleteAjax",userid:a,transfer_user_id:k.find('[name="tranfer_owner_id"]').val(),mode:"permanent"};app.hideModalWindow();AppConnector.request(m).then(function(n){if(n.success){l.progressIndicator({mode:"hide"});m={title:app.vtranslate("JS_MESSAGE"),text:n.result.message,animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(m);jQuery("[data-id="+a+"]").hide()}})}return false};jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(f,function(h){if(typeof g=="function"){g(h)}})}})})},restoreUser:function(a,b){b.stopPropagation();Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("LBL_RESTORE_CONFIRMATION")}).then(function(){var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d={module:app.getModuleName(),action:"SaveAjax",userid:a,mode:"restoreUser"};AppConnector.request(d).then(function(e){if(e.success){c.progressIndicator({mode:"hide"});Vtiger_Helper_Js.showPnotify(e.result.message);var f=e.result.listViewUrl;window.location.href=f}})})},triggerExportAction:function(){var a=window.location.href;var c=a.split("?");var b=jQuery("<form>",{method:"post",action:c[0]+"?module=Users&source_module=Users&action=ExportData"}).append(jQuery("<input>",{name:csrfMagicName,value:csrfMagicToken,type:"hidden"}));jQuery(b).appendTo("body")[0].submit()},},{getPageJumpParams:function(){var c=app.getModuleName();var b=this.getCurrentCvId();var a={module:c,view:"ListAjax",mode:"getPageCount",search_params:jQuery("#usersFilter").val()};return a},registerDeleteRecordClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".deleteRecordButton",function(d){var c=jQuery(d.currentTarget);var b=c.closest("tr");var f=jQuery('[name="deleteActionUrl"]',b).val();Settings_Users_List_Js.deleteRecord(f);d.stopPropagation()})},usersFilter:function(){var a=this;jQuery("#usersFilter").change(function(){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c={module:app.getModuleName(),view:"List",parent:app.getParentModuleName(),search_params:jQuery("#usersFilter").val()};AppConnector.request(c).then(function(e){b.progressIndicator({mode:"hide"});jQuery("#listViewContents").html(e);a.updatePaginationFilter();var d=a.getListSearchInstance();if(d!==false){d.registerEvents()}app.showSelect2ElementView(jQuery("#listViewContents").find("select.select2"))})})},updatePaginationFilter:function(){var a=this;var b={};b.page=1;b.module=app.getModuleName();b.parent=app.getParentModuleName();b.view="Pagination";b.mode="getPagination";b.search_params=jQuery("#usersFilter").val();AppConnector.request(b).then(function(c){jQuery(".paginationDiv").html(c);a.registerPageNavigationEvents()})},updatePagination:function(a){a=typeof a!=="undefined"?a:1;var b=this;var c={};c.module=app.getModuleName();c.parent=app.getParentModuleName();c.view="Pagination";c.page=a;c.mode="getPagination";c.search_key=this.getAlphabetSearchField();c.search_value=this.getAlphabetSearchValue();c.operator="s";c.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams());c.noOfEntries=jQuery("#noOfEntries").val();AppConnector.request(c).then(function(d){jQuery(".paginationDiv").html(d);b.registerPageNavigationEvents()})},registerEvents:function(){this._super();this.usersFilter();this.registerDeleteRecordClickEvent()}});